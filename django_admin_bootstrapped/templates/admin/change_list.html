<!-- Archivo modificado  -->
{% load i18n admin_static admin_list bootstrapped_goodies_tags %}
{% load url from future %}
{% load admin_urls %}
{% load tags %}

{% block extrastyle %}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}" />
  {% if cl.formset %}
    <link rel="stylesheet" type="text/css" href="{% static "admin/css/forms.css" %}" />
  {% endif %}
  {% if cl.formset or action_form %}
    {% url 'admin:jsi18n' as jsi18nurl %}
    <script type="text/javascript" src="{{ jsi18nurl|default:'../../jsi18n/' }}"></script>
  {% endif %}
{% endblock %}

{% block extrahead %}
{% if action_form %}{% if actions_on_top or actions_on_bottom %}
<script type="text/javascript">
(function($) {
    $(document).ready(function($) {
        $("tr input.action-select").actions();
    });
})(django.jQuery);
</script>
{% endif %}{% endif %}
{% endblock %}

{% block messages %}
{% if messages %}
<div class="row-fluid">
    <div class="span12">
        <div class="alert alert-info">
            <ul class="unstyled">
                {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}
{% endblock messages %}


{% if not is_popup %}
{% block breadcrumbs %}
<ul class="breadcrumb">
<li><a href="{% url 'admin:index' %}">{% trans 'Home' %}</a><span class="divider"></span></li>
<!--<li><a href="{% url 'admin:app_list' app_label=cl.opts.app_label %}">{% render_with_template_if_exist app_label|lower|add:"/admin_app_name.html" app_label %}</a> <span class="divider">/</span></li>-->
<li><span class="divider">/</span></li>
<li>{{ cl.opts.verbose_name_plural|capfirst }}</li>
</ul>
{% endblock %}
{% endif %}

<div id="content" class="flex">       
    <div class="row-fluid">
        <div class="navbar">
            <div class="navbar-inner">             
                <a class="brand">Seleccione persona a modificar</a>
                {% block object-tools %}
                    {% block object-tools-items %}
                    <div class="form-inline pull-left">
                        {% if has_add_permission %}
                        <a id='add_{{cl.opts.verbose_name}}' href="#" class="btn btn-primary">
                            <i class="icon-plus icon-white"></i> {% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
                        </a>
                        {% endif %}
                        {% comment %} {% if action_form and actions_on_top and cl.full_result_count %}
                            {% admin_actions %}
                        {% endif %}{% endcomment %}
                    </div>
                    {% endblock %}

                    <div class="pull-right">
                        {% block search %}{% search_form cl %}{% endblock %}
                        {% if cl.has_filters %}
                        <ul class="nav">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{% trans 'Filter' %} <b class="caret"></b></a>
                                <ul class="dropdown-menu pull-right">
                                    {% for spec in cl.filter_specs %}
                                        {% admin_list_filter cl spec %}
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                        {% endif %}
                    </div>
                {% endblock %}
            </div>
        </div>
    </div>
{% block content %}
<form class="" id="changelist-form" action="" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}>{% csrf_token %}

{% if cl.formset.errors %}
<div class="row-fluid">
    <div class="alert alert-error">
        <p class="errornote">
            {% blocktrans count cl.formset.errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
        </p>
        {{ cl.formset.non_form_errors }}
    </div>
</div>
{% endif %}

<div class="row-fluid">

    {% with app_name=cl.opts.module_name|lower|slugify %}
        {% render_with_template_if_exist cl.opts.app_label|lower|add:"/admin_app_"|add:app_name|add:"_description.html" "" %}
    {% endwith %}

    <div class="span12">

        <div id="content-main" class="row-fluid">
            {# {% if cl.formset and cl.result_count %} #}
            <div class="row-fluid">
                <div class="navbar">
                    <div class="navbar-inner">
                        <div class="form-inline pull-left">
                            {% if action_form and cl.full_result_count %}
                                {% admin_actions %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {# {% endif %} #}
            <div class="module{% if cl.has_filters %} filtered{% endif %}" id="_changelist">
                {% block date_hierarchy %}
                    {% date_hierarchy cl %}
                {% endblock %}

                {% if cl.formset %}
                    <div>{{ cl.formset.management_form }}</div>
                {% endif %}

                {% block result_list %}
                    {% result_list cl %}
                {% endblock %}
            </div>
        </div>
    </div>

</div>
{% block pagination %}
    {% pagination cl %}
{% endblock %}
</form>
{% endblock %}
</div>
<script type="text/javascript">
    $(function(){
        $('#add_{{cl.opts.verbose_name}}').on('click',agregar);
        function agregar(e)
        {
            var ruta="{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?_popup=1{% endif %}"
            if(ruta!='')
            {
                $.ajax({
                    async:false,
                    url:ruta,
                    data:{csrfmiddlewaretoken:'{{csrf_token}}'},
                    type:'GET',
                    //dataType:
                    success:function(response)
                    {
                        if(response!='')
                        {
                            //$('body').removeClass();
                            //$('body').addClass('_change-list')
                            $('#content-main').hide(500,function()
                                {
                                    $('#content-main').html(response);
                                    $('#content-main').show(1000);
                                });
                            //class:_change-list
                            //class: dashboard
                        }
                        else
                        {
                            alert('No hubo respuesta por parte del servidor.');
                        }
                    },
                    error:function(jqXHR, status, error)
                    {
                        alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                    },
                    // complete:function(jqXHR, status)
                    // {
                    //     alert(jqXHR.responseText+'\n'+status)
                    // },
                });
            }
            else
            {
                alert('Error inesperado al tratar de cargar el modulo deseado. Consulte a su administrador.')
            }
        }
        $("#result_list a").on('click',modificar);
        function modificar(e)
        {
            var elemento=e.target;
            var ref=elemento.href;
            $.ajax({
                async:false,
                url:ref,
                data:{csrfmiddlewaretoken:'{{csrf_token}}'},
                type:'GET',
                //dataType:
                success:function(response)
                {
                    if(response!='')
                    {
                        //$('body').removeClass();
                        //$('body').addClass('_change-list')
                        $('#content-main').hide(500,function()
                            {
                                $('#content-main').html(response);
                                $('#content-main').show(1000);
                            });
                        //class:_change-list
                        //class: dashboard
                    }
                    else
                    {
                        alert('No hubo respuesta por parte del servidor.');
                    }
                },
                error:function(jqXHR, status, error)
                {
                    alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                },
                // complete:function(jqXHR, status)
                // {
                //     alert(jqXHR.responseText+'\n'+status)
                // },
            });
            return false;
        }
        $('#changelist-search').on('keypress',buscar);
        function buscar(e)
        {
            if(e.charCode==13)
            {
                var elemento= e.target;
                var valor= elemento.value;
                var ref = "{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?_popup=1{% endif %}" ;
                ref = ref.split('add')[0];
                $.ajax({
                    async:false,
                    url:ref,
                    data:{'q':valor},
                    type:'GET',
                    //dataType:
                    success:function(response)
                    {
                        if(response!='')
                        {
                            //$('body').removeClass();
                            //$('body').addClass('_change-list')
                            $('#content-main').hide(500,function()
                                {
                                    $('#content-main').html(response);
                                    $('#content-main').show(1000);
                                });
                            //class:_change-list
                            //class: dashboard
                        }
                        else
                        {
                            alert('No hubo respuesta por parte del servidor.');
                        }
                    },
                    error:function(jqXHR, status, error)
                    {
                        alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                    },
                    // complete:function(jqXHR, status)
                    // {
                    //     alert(jqXHR.responseText+'\n'+status)
                    // },   
                });
                return false;
            }
        }
        $('#changelist-search a').on('click',recargar);
        function recargar(e)
        {
            var ref = "{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?_popup=1{% endif %}" ;
            ref = ref.split('add')[0];
            $.ajax({
                async:false,
                url:ref,
                data:{csrfmiddlewaretoken:'{{csrf_token}}'},
                type:'POST',
                //dataType:
                success:function(response)
                {
                    if(response!='')
                    {
                        //$('body').removeClass();
                        //$('body').addClass('_change-list')
                        $('#content-main').hide(500,function()
                            {
                                $('#content-main').html(response);
                                $('#content-main').show(1000);
                            });
                        //class:_change-list
                        //class: dashboard
                    }
                    else
                    {
                        alert('No hubo respuesta por parte del servidor.');
                    }
                },
                error:function(jqXHR, status, error)
                {
                    alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                },
                // complete:function(jqXHR, status)
                // {
                //     alert(jqXHR.responseText+'\n'+status)
                // },   
            });
            return false;
        }
        $('.pagination a').on('click',paginacion);
        function paginacion(e)
        {
            var elemento=e.target;
            var valor=elemento.text;
            valor-=1;
            if(elemento.className=='showall')
            {
                datos={all:''};
            }
            else
            {
                datos={p:valor};
            }
            var ref = "{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?_popup=1{% endif %}" ;
            ref = ref.split('add')[0];
            $.ajax({
                async:false,
                url:ref,
                data:datos,
                type:'GET',
                //dataType:
                success:function(response)
                {
                    if(response!='')
                    {
                        //$('body').removeClass();
                        //$('body').addClass('_change-list')
                        $('#content-main').hide(500,function()
                            {
                                $('#content-main').html(response);
                                $('#content-main').show(1000);
                            });
                        //class:_change-list
                        //class: dashboard
                    }
                    else
                    {
                        alert('No hubo respuesta por parte del servidor.');
                    }
                },
                error:function(jqXHR, status, error)
                {
                    alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                },
                // complete:function(jqXHR, status)
                // {
                //     alert(jqXHR.responseText+'\n'+status)
                // },   
            });
            return false;
        }
        $('button[name="index"]').on('click',acciones);
        function acciones(e)
        {
            var form=$("#{{ cl.opts.module_name }}_form");
            var ref = "{% url 'admin:app_list' app_label=cl.opts.app_label %}{{ cl.opts.module_name }}/" ;
            $button = $('.actions button[name="index"]');
            var index=$button.val();
            $selected =$('.actions select[name="action"] option:selected');
            var accion =$selected.val();
            checkboxs = $('#result_list td input[type="checkbox"]');
            var choosens="";
            for(x=0;x<checkboxs.length;x++)
            {
                if(checkboxs[x].checked)
                {
                    choosens+="&_selected_action="+checkboxs[x].value;
                }
            }
            //ref = ref.split('add')[0];
            $.ajax({
                async:false,
                url:ref,
                data:"csrfmiddlewaretoken={{csrf_token}}&index="+index+"&action="+accion+"&select_across=0"+choosens,
                type:'POST',
                success:function(response)
                {
                    if(response!='')
                    {
                        //$('body').removeClass();
                        //$('body').addClass('_change-list')
                        $('#content-main').hide(500,function()
                            {
                                $('#content-main').html(response);
                                $('#content-main').show(1000);
                            });
                        //class:_change-list
                        //class: dashboard
                    }
                    else
                    {
                        alert('No hubo respuesta por parte del servidor.');
                    }
                },
                error:function(jqXHR, status, error)
                {
                    alert(jqXHR.responseText+'\n'+status+'\n'+ error);
                },
                // complete:function(jqXHR, status)
                // {
                //     alert(jqXHR.responseText+'\n'+status)
                // },
            });
            return false;
        }
    });
</script>